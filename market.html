<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Greenlet â€” Market</title><link rel="stylesheet" href="style.css"><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script><script src="firebase.js"></script><script src="app.js"></script></head><body><script>renderSidebar()</script><div class="content"><div class="page-title">Market</div><div class="panel"><div class="small">Buy packs with your Tokens</div><div id="packs" class="grid" style="grid-template-columns:repeat(3,1fr);margin-top:12px"></div></div></div><div id="overlay" style="display:none" class="overlay"><div class="pack-view" id="packView" onclick="onOverlayClick()"><div id="packTitle" style="font-size:20px"></div><div id="packBody" style="margin-top:22px"></div><div class="small" style="margin-top:8px">Click to continue</div></div></div><script>const allPacks=[{id:'forest',name:'Forest Pack',price:25,greens:['Sprout','Leafling','Mossling','Buddo','Ferny']},{id:'retro',name:'Retro Pack',price:50,greens:['Pixel','Blocky','Tape','CRT','Glitch']},{id:'aqua',name:'Aqua Pack',price:40,greens:['Bubble','Kelp','Coral','Dew','Pearl']},{id:'safari',name:'Safari Pack',price:35,greens:['Bark','Fang','Paw','Stripe','Horn']},{id:'spooky',name:'Spooky Pack',price:30,greens:['Spookle','Ghoul','Bone','Shade','Pump']},{id:'magic',name:'Magic Pack',price:60,greens:['Spark','Wisp','Rune','Glim','Hex']}];function renderPacks(){const c=document.getElementById('packs');c.innerHTML='';allPacks.forEach(p=>{const el=document.createElement('div');el.className='card';el.innerHTML=`<div style="height:120px;border-radius:10px;background:linear-gradient(90deg,#6ed46a,#2b7f2f)"></div><div style="font-weight:700;margin-top:8px">${p.name}</div><div class="small">${p.price} ðŸŒ¿</div><div style="margin-top:8px"><button class="pill" onclick="buyPack('${p.id}')">Buy</button></div>`;c.appendChild(el);});}renderPacks();let currentPack=null;let openPhase=0;async function buyPack(packId){requireAuth(async (user)=>{const uid=user.uid;const doc=await db.collection('users').doc(uid).get();const data=doc.data();const pack=allPacks.find(x=>x.id===packId);if((data.tokens||0)<pack.price){alert('Not enough tokens');return;}await db.collection('users').doc(uid).update({tokens:(data.tokens||0)-pack.price,packsOpened:(data.packsOpened||0)+1});currentPack=pack;openPhase=1;document.getElementById('overlay').style.display='flex';document.getElementById('packTitle').innerText=pack.name;document.getElementById('packBody').innerHTML='<div style="width:160px;height:160px;border-radius:18px;background:linear-gradient(90deg,#95e573,#2f8b2f);display:flex;align-items:center;justify-content:center;font-weight:800">PACK</div>';});}function onOverlayClick(){if(openPhase===1){const greens=currentPack.greens;const g=greens[Math.floor(Math.random()*greens.length)];document.getElementById('packBody').innerHTML='<div id="greenBox" class="pack-green">'+g+'</div>';openPhase=2;}else if(openPhase===2){requireAuth(async (user)=>{await db.collection('users').doc(user.uid).set({greens:{[currentPack.id]: firebase.firestore.FieldValue.arrayUnion(document.getElementById('greenBox').innerText)}},{merge:true});document.getElementById('overlay').style.display='none';openPhase=0;currentPack=null;alert('Green saved to your Greens page!');});}};</script></body></html>